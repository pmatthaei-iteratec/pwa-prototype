<mat-toolbar color="primary">
  <button mat-icon-button>
    <mat-icon>menu</mat-icon>
  </button>
  <span fxFlex="grow">BMS Mobile</span>
  <button mat-icon-button>
    <mat-icon>wifi</mat-icon>
  </button>
  <button mat-icon-button>
    <mat-icon>person</mat-icon>
  </button>
</mat-toolbar>

<mat-tab-group fxFlexFill>

  <mat-tab label="Schadenserfassung">
    <div fxFlex fxLayout="column">
      <div [formGroup]="form" fxLayout="column" fxLayoutGap="12px">

        <mat-form-field fxFlex>
          <mat-label>Titel</mat-label>
          <input matInput formControlName="title">
        </mat-form-field>

        <div fxFlex>
          <button type="button" mat-raised-button (click)="fileInput.click()">Bild aufnehmen</button>
          <input hidden #fileInput type="file" #imageFileInput (change)="setFile($event)" accept="image/*"
                 capture="environment"/>
        </div>

        <div fxFlex fxLayoutAlign="center">
          <div fxFlex *ngIf="!videoCapable">Access to camera denied</div>
          <video fxFlex width="100%" *ngIf="videoCapable && !pictureTaken" #video autoplay></video>
          <canvas fxFlex [fxHide]="!pictureTaken" #canvas width="100%"></canvas>
        </div>

        <div fxFlex fxLayoutGap="12px">
          <button *ngIf="videoCapable" mat-raised-button (click)="captureImage()">Bild aufnehmen</button>
          <a *ngIf="pictureTaken" mat-flat-button href="{{downloadLink}}" download="image.png"><i
            class="fa fa-download"></i>
            Download</a>
        </div>

        <mat-form-field>
          <mat-label>Anzahl</mat-label>
          <input matInput formControlName="count" placeholder="Wie oft soll der Schaden hinterlegt werden?">
        </mat-form-field>

        <mat-divider></mat-divider>

        <div fxFlex>
          <button [disabled]="form.invalid" mat-raised-button color="primary" (click)="save()">Speichern</button>
        </div>
      </div>
    </div>
  </mat-tab>

  <mat-tab label="Schadensliste">
    <ng-container *ngIf="schaeden$ | async as schaeden">
      <ng-template mat-tab-label>
        <div>Schadensliste ({{ schaeden.length}})</div>
      </ng-template>
      <div fxFlex="50%" fxLayout="column">
        <mat-selection-list [multiple]="false" style="overflow: auto">
          <mat-list-option *ngFor="let schaden of schaeden" [value]="schaden">
            <div fxFlex>
              <div fxFlexFill>{{schaden.title}}</div>
              <button fxFlex mat-icon-button (click)="deleteSchaden(schaden.id)">
                <mat-icon>delete</mat-icon>
              </button>
            </div>

          </mat-list-option>
        </mat-selection-list>
      </div>
    </ng-container>
  </mat-tab>

  <mat-tab label="Ãœbersichtsplan">
    <div style="height: 400px" >
      <div leaflet style="height: 400px" fxFlexFill
           leafletDraw
           [leafletOptions]="options"
           [leafletDrawOptions]="drawOptions"
           (leafletDrawCreated)="onDrawCreated($event)">
        <div [leafletLayer]="drawnItems"></div>
      </div>
    </div>

  </mat-tab>
</mat-tab-group>

